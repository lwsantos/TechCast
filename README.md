# TechCrunch Scraper

Um web scraper em TypeScript/Node.js para extrair not√≠cias do site TechCrunch e traduzi-las para portugu√™s.

## üéØ Objetivo

O scraper extrai as seguintes informa√ß√µes das not√≠cias mais recentes:

1. **T√≠tulo da Not√≠cia:** O t√≠tulo principal do artigo
2. **URL do Artigo:** O link direto para a not√≠cia completa
3. **Data de Publica√ß√£o:** A data em que a not√≠cia foi publicada
4. **Autor:** O nome do autor do artigo (quando dispon√≠vel)
5. **Conte√∫do Principal:** O texto completo do corpo da not√≠cia

E o tradutor adiciona:
6. **T√≠tulo Traduzido:** Vers√£o em portugu√™s do t√≠tulo
7. **Conte√∫do Traduzido:** Vers√£o em portugu√™s do conte√∫do

## üìã Pr√©-requisitos

### Para Instala√ß√£o Local
- Node.js vers√£o 22 ou superior (recomendamos usar NVM para gerenciar vers√µes)
- npm ou yarn
- FFmpeg instalado no sistema
- Conta no Google Cloud Platform com Translation API habilitada
- Arquivo de credenciais do Google Cloud (`podcast-tech-news-key.json`)
- **Opcional:** Bot do Telegram para notifica√ß√µes

### Para Instala√ß√£o com Docker
- Docker e Docker Compose instalados
- Conta no Google Cloud Platform com Translation API habilitada
- Arquivo de credenciais do Google Cloud (`podcast-tech-news-key.json`)
- **Opcional:** Bot do Telegram para notifica√ß√µes
- **Nota:** FFmpeg ser√° instalado automaticamente no container

### Configurando o Node.js 22 com NVM

```bash
# Instalar Node.js 22
nvm install 22

# Usar Node.js 22
nvm use 22

# Definir Node.js 22 como padr√£o (opcional)
nvm alias default 22
```

### Configurando o Google Cloud APIs

1. Crie um projeto no Google Cloud Console
2. Habilite as seguintes APIs:
   - Google Cloud Translation API (para tradu√ß√£o tradicional)
   - Google AI Studio (Gemini) - **Recomendado para tradu√ß√£o econ√¥mica**
   - Google Cloud Text-to-Speech API
   - YouTube Data API v3
3. Crie uma conta de servi√ßo e baixe o arquivo JSON de credenciais
4. Coloque o arquivo de credenciais na raiz do projeto como `podcast-tech-news-key.json`
5. Configure as vari√°veis de ambiente:

```bash
# Copie o arquivo de exemplo
cp env.example .env

# Edite o arquivo .env com suas configura√ß√µes
GOOGLE_API_KEY=sua-api-key-aqui
GOOGLE_CLOUD_PROJECT_ID=seu-project-id-aqui
GEMINI_API_KEY=sua-chave-do-gemini-aqui
```

**Nota:** 
- O tradutor original usa o arquivo `podcast-tech-news-key.json`
- O tradutor Gemini usa a `GEMINI_API_KEY` (mais econ√¥mico)
- O gerador de podcast e o gerador de √°udio usam a `GOOGLE_API_KEY`

### üöÄ Configurando Gemini AI para Tradu√ß√£o Econ√¥mica

Para usar o Gemini AI (97.5% mais barato que Google Translate):

1. Acesse [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Fa√ßa login e crie uma API Key
3. Adicione no `.env`: `GEMINI_API_KEY=sua-chave-aqui`
4. Teste a conex√£o: `npm run test:gemini`
5. Use para tradu√ß√£o: `npm run translate:gemini`

Veja mais detalhes em [GEMINI_TRANSLATION.md](./GEMINI_TRANSLATION.md)

### üîê Autoriza√ß√£o do YouTube

Para fazer upload de v√≠deos diretamente para o YouTube, voc√™ precisa configurar a autoriza√ß√£o OAuth2:

#### 1. Configurar Credenciais OAuth2

1. No Google Cloud Console, v√° para "APIs & Services" > "Credentials"
2. Clique em "Create Credentials" > "OAuth 2.0 Client IDs"
3. Configure o tipo de aplicativo como "Desktop application"
4. Baixe o arquivo JSON de credenciais
5. Renomeie para `oAuthCredentials.json` e coloque na pasta `credentials/`

#### 2. Executar Script de Autoriza√ß√£o

```bash
# Executar o script de autoriza√ß√£o
npm run token
```

#### 3. Processo de Autoriza√ß√£o

O script seguir√° estes passos:

1. **URL de Autoriza√ß√£o:** O script imprimir√° uma URL no console
2. **Abertura Autom√°tica:** Tentar√° abrir essa URL no seu navegador padr√£o
3. **Login Google:** No navegador, fa√ßa login na conta do Google associada ao canal do YouTube
4. **Tela de Consentimento:** Voc√™ ver√° a tela de permiss√£o OAuth configurada no Google Cloud Console
5. **Permitir Acesso:** Clique em "Permitir" para autorizar o aplicativo
6. **C√≥digo de Autoriza√ß√£o:** Uma p√°gina com um c√≥digo ser√° exibida
7. **Copiar C√≥digo:** Copie o c√≥digo de autoriza√ß√£o
8. **Colar no Terminal:** Volte ao terminal, cole o c√≥digo quando solicitado e pressione Enter

#### 4. Resultado

Ap√≥s a autoriza√ß√£o bem-sucedida:
- O `refresh_token` ser√° exibido no console
- Os tokens ser√£o salvos automaticamente em `credentials/youtube_token.json`
- Este token permitir√° uploads futuros sem reautoriza√ß√£o

**‚ö†Ô∏è Importante:** Guarde o `refresh_token` de forma segura. Ele √© v√°lido at√© que voc√™ revogue o acesso no Google Cloud Console.

### üì± Configura√ß√£o do Telegram

Para receber notifica√ß√µes sobre o progresso do pipeline, voc√™ pode configurar um bot do Telegram:

#### 1. Criar um Bot no Telegram

1. **Abra seu aplicativo Telegram**
2. **Procure por @BotFather** na barra de pesquisa
3. **Inicie uma conversa** com ele e use o comando `/newbot`
4. **Siga as instru√ß√µes** para dar um nome ao seu bot (ex: "TechCast Notifier Bot") e um username (deve terminar com "bot", ex: "TechCastNotifier_bot")
5. **@BotFather lhe dar√° um HTTP API Token** (uma longa sequ√™ncia de caracteres, ex: `123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11`). Este √© o token que seu script Node.js usar√° para enviar mensagens. **Guarde-o com seguran√ßa**

#### 2. Obter o Chat ID

Voc√™ precisa saber para qual chat o bot deve enviar as mensagens:

**Para conversa privada:**
1. **Inicie uma conversa** com o seu rec√©m-criado bot no Telegram
2. **Mande qualquer mensagem** para ele (ex: "Ol√°")
3. **Abra a URL** no seu navegador (substituindo `SEU_BOT_TOKEN` pelo token que voc√™ obteve do BotFather):
   ```
   https://api.telegram.org/botSEU_BOT_TOKEN/getUpdates
   ```
4. **Procure por "chat"** e, dentro dele, o "id" num√©rico (ex: `123456789`). Este √© o seu `chat_id`

**Para grupos:**
- Adicione o bot ao grupo
- Mande uma mensagem no grupo
- Use a mesma URL acima - o `chat_id` de um grupo √© negativo

#### 3. Configurar as Vari√°veis de Ambiente

Adicione as seguintes vari√°veis ao seu arquivo `.env`:

```bash
# Telegram Configuration
TELEGRAM_BOT_TOKEN=123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11
TELEGRAM_CHAT_ID=123456789
```

#### 4. Testar a Configura√ß√£o

Execute o scraper para testar se as notifica√ß√µes est√£o funcionando:

```bash
npm run scraper
```

Voc√™ deve receber mensagens no Telegram sobre:
- In√≠cio do scraping
- Conclus√£o do scraping
- Erros (se houver)

#### 5. Exemplos de Mensagens

O bot enviar√° mensagens como:
```
üöÄ Scraping de not√≠cias iniciado...
‚úÖ Scraping conclu√≠do! 15 artigos coletados
‚ùå Erro durante o scraping: [detalhes do erro]
```

#### Observa√ß√µes Importantes

- **Seguran√ßa:** Nunca compartilhe seu bot token publicamente
- **Grupos:** Para enviar mensagens em grupos, o bot precisa ter permiss√µes de administrador
- **Limites:** O Telegram tem limites de taxa para envio de mensagens
- **Formata√ß√£o:** As mensagens usam MarkdownV2 para formata√ß√£o (caracteres especiais s√£o escapados automaticamente)

## üöÄ Instala√ß√£o

### Op√ß√£o 1: Instala√ß√£o Local

1. Clone ou baixe este reposit√≥rio
2. Certifique-se de estar usando Node.js 22:
   ```bash
   node --version
   # Deve mostrar v22.x.x
   ```
3. Instale as depend√™ncias:
   ```bash
   npm install
   ```
4. Configure as vari√°veis de ambiente (veja se√ß√£o acima)

### Op√ß√£o 2: Instala√ß√£o com Docker (Recomendado)

**üìñ Documenta√ß√£o completa:** [DOCKER.md](./DOCKER.md)

#### Pr√©-requisitos
- Docker e Docker Compose instalados
- FFmpeg ser√° instalado automaticamente no container

#### Configura√ß√£o
1. Clone ou baixe este reposit√≥rio
2. Configure o arquivo `.env` com suas credenciais
3. Certifique-se de que os arquivos necess√°rios est√£o presentes:
   - `TechCast.png` (imagem para o v√≠deo)
   - `credentials/` (pasta com credenciais do Google Cloud)
   - `.env` (vari√°veis de ambiente)
   - **Opcional:** Configurar bot do Telegram para notifica√ß√µes

#### Build e Execu√ß√£o

**M√©todo 1: Script Autom√°tico (Recomendado)**
```bash
# Executar script de setup completo
npm run docker:setup
```

**M√©todo 2: Comandos Manuais**
```bash
# Build da imagem
npm run docker:build

# Executar o container
npm run docker:up

# Ver logs
npm run docker:logs

# Parar o container
npm run docker:down
```

**Comandos NPM Dispon√≠veis:**
- `npm run docker:build` - Build da imagem
- `npm run docker:up` - Iniciar container
- `npm run docker:down` - Parar container
- `npm run docker:logs` - Ver logs
- `npm run docker:setup` - Setup completo autom√°tico
- `npm run docker:restart` - Reiniciar container
- `npm run docker:shell` - Acessar shell do container

#### Acessar a API
- API: `http://localhost:3100`
- Health Check: `http://localhost:3100/health`
- Documenta√ß√£o: `http://localhost:3100/api/docs`

#### Volumes Montados
- `./output` ‚Üí `/app/output` (arquivos gerados)
- `./.env` ‚Üí `/app/.env` (configura√ß√µes)

#### Comandos √öteis
```bash
# Executar comando espec√≠fico no container
npm run docker:shell
# Dentro do container: npm run scraper

# Ou executar diretamente (se docker-compose estiver dispon√≠vel)
docker-compose exec techcast-api npm run scraper
# Ou (vers√£o mais recente do Docker)
docker compose exec techcast-api npm run scraper

# Acessar shell do container
npm run docker:shell

# Rebuild ap√≥s mudan√ßas no c√≥digo
npm run docker:build
npm run docker:up

# Ver logs em tempo real
npm run docker:logs

# Reiniciar container
npm run docker:restart
```

## üèÉ‚Äç‚ôÇÔ∏è Como usar

### üéØ Pipeline Completo (Recomendado)

Execute todas as etapas de uma vez (scraper + tradu√ß√£o + roteiro + √°udio + v√≠deo + upload):

```bash
npm run pipeline
```

**Nota:** O upload para YouTube √© opcional e pode falhar se as credenciais OAuth2 n√£o estiverem configuradas. Nesse caso, o pipeline continuar√° normalmente e voc√™ pode fazer o upload manualmente com `npm run upload`.

### üì± Notifica√ß√µes do Pipeline

Se voc√™ configurou o bot do Telegram, receber√° notifica√ß√µes sobre:

- **In√≠cio de cada etapa** do pipeline
- **Conclus√£o bem-sucedida** de cada etapa
- **Erros** durante a execu√ß√£o
- **Resumo final** do pipeline

**Exemplo de notifica√ß√µes:**
```
üöÄ Pipeline iniciado...
üì∞ Scraping de not√≠cias iniciado...
‚úÖ Scraping conclu√≠do! 15 artigos coletados
üåê Tradu√ß√£o iniciada...
‚úÖ Tradu√ß√£o conclu√≠da!
üéôÔ∏è Gera√ß√£o de roteiro iniciada...
‚úÖ Roteiro gerado com sucesso!
üîä Gera√ß√£o de √°udio iniciada...
‚úÖ √Åudio gerado com sucesso!
üé¨ Gera√ß√£o de v√≠deo iniciada...
‚úÖ V√≠deo gerado com sucesso!
üì§ Upload para YouTube iniciado...
‚úÖ Upload conclu√≠do! V√≠deo dispon√≠vel em: https://youtube.com/watch?v=...
üéâ Pipeline conclu√≠do com sucesso!
```

### üîß Execu√ß√£o Individual

Voc√™ tamb√©m pode executar cada etapa separadamente:

#### 1. Extrair not√≠cias do TechCrunch
```bash
npm run scraper
```

#### 2. Traduzir as not√≠cias para portugu√™s
```bash
npm run translate
```

#### 3. Gerar roteiro do podcast
```bash
npm run podcast
```

#### 4. Gerar √°udio do podcast
```bash
npm run audio
```

#### 5. Gerar v√≠deo para YouTube
```bash
npm run video
```

#### 6. Fazer upload para YouTube (opcional)
```bash
npm run upload
```

### üåê API RESTful

O projeto inclui uma API RESTful completa para automatizar todas as opera√ß√µes:

#### Iniciar a API
```bash
npm run api
```

A API estar√° dispon√≠vel em: `http://localhost:3100`

#### Endpoints Dispon√≠veis

**Health Check:**
- `GET /api/health` - Verificar status da API

**Cron:**
- `GET /api/cron/next-execution` - Verificar pr√≥xima execu√ß√£o programada do cron

**Not√≠cias:**
- `GET /api/news/scrape` - Iniciar scraping de not√≠cias
- `GET /api/news/translate` - Traduzir not√≠cias

**Podcast:**
- `GET /api/podcast/generate-script` - Gerar roteiro do podcast
- `GET /api/podcast/generate-audio` - Gerar √°udio do podcast
- `GET /api/podcast/generate-video` - Gerar v√≠deo do podcast

**YouTube:**
- `POST /api/youtube/upload` - Upload para YouTube
- `GET /api/youtube/upload` - Upload para YouTube (m√©todo GET)

**Pipeline:**
- `GET /api/pipeline/execute` - Executar pipeline completo
- `GET /api/pipeline/status` - Verificar status do pipeline

**Output:**
- `GET /api/output/list` - Listar todos os arquivos gerados
- `GET /api/output/download/:type/:filename` - Download de arquivos

**Documenta√ß√£o:**
- `GET /api/docs` - Documenta√ß√£o completa da API

#### Exemplos de Uso

```bash
# Executar pipeline completo via API
curl -X GET http://localhost:3100/api/pipeline/execute

# Verificar pr√≥xima execu√ß√£o do cron
curl -X GET http://localhost:3100/api/cron/next-execution

# Listar todos os arquivos gerados
curl -X GET http://localhost:3100/api/output/list

# Fazer upload para YouTube
curl -X POST http://localhost:3100/api/youtube/upload

# Download de um v√≠deo espec√≠fico
curl -X GET http://localhost:3100/api/output/download/video/podcast_video_2025-01-08.mp4
```

### Modo watch (desenvolvimento)

```bash
# Compilar em modo watch
npm run watch
```

### Limpar arquivos compilados

```bash
npm run clean
```

### ‚è∞ Agendamento Autom√°tico (Cron Integrado)

O pipeline √© executado automaticamente todos os dias no hor√°rio configurado (padr√£o: **20:00** no timezone de S√£o Paulo) pelo cron job integrado ao servidor Express da API.

#### Configura√ß√£o do Cron

As configura√ß√µes do cron podem ser alteradas via vari√°veis de ambiente:

```bash
# Hor√°rio de execu√ß√£o (formato HH:MM)
CRON_EXECUTION_TIME=20:00

# Timezone para execu√ß√£o
CRON_TIMEZONE=America/Sao_Paulo
```

**Exemplos de configura√ß√£o:**
- `CRON_EXECUTION_TIME=08:00` - Executar √†s 8h da manh√£
- `CRON_EXECUTION_TIME=22:30` - Executar √†s 22h30
- `CRON_TIMEZONE=America/New_York` - Usar timezone de Nova York

- **Agendamento:** N√£o √© necess√°rio configurar scripts externos ou systemd/launchd.
- **Timezone:** America/Sao_Paulo (GMT-3, considera hor√°rio de ver√£o automaticamente)
- **Evita execu√ß√µes simult√¢neas:** O pipeline n√£o ser√° iniciado se j√° estiver rodando.
- **Logs:** Toda execu√ß√£o do pipeline via cron √© logada no console do servidor.
- **Execu√ß√£o manual:** Voc√™ pode disparar o pipeline manualmente via API a qualquer momento.



#### Exemplo de resposta do status:

```json
{
  "success": true,
  "message": "Status do cron job",
  "data": {
    "isRunning": false,
    "nextExecution": "09/07/2025 20:00:00",
    "schedule": "Todos os dias no hor√°rio configurado (padr√£o: 20:00)",
    "timezone": "America/Sao_Paulo",
    "cronExpression": "0 20 * * *"
  }
}
```

#### Exemplo de resposta da pr√≥xima execu√ß√£o:

```json
{
  "success": true,
  "message": "Pr√≥xima execu√ß√£o do cron",
  "data": {
    "nextExecution": "09/07/2025 20:00:00",
    "schedule": "Todos os dias no hor√°rio configurado (padr√£o: 20:00)",
    "timezone": "America/Sao_Paulo",
    "cronExpression": "0 20 * * *",
    "timestamp": "2025-07-09T17:30:00.000Z"
  }
}
```

#### Como funciona a pr√≥xima execu√ß√£o
- Se o hor√°rio atual for **antes do hor√°rio configurado**, a pr√≥xima execu√ß√£o √© hoje no hor√°rio configurado.
- Se for **ap√≥s o hor√°rio configurado**, a pr√≥xima execu√ß√£o √© amanh√£ no hor√°rio configurado.

#### Logs de execu√ß√£o

No console do servidor, voc√™ ver√° logs como:
```
‚è∞ Cron job configurado: Pipeline executar√° todos os dias no hor√°rio configurado (padr√£o: 20:00)
‚è∞ Express√£o cron: 0 20 * * *
‚è∞ Pr√≥xima execu√ß√£o: 09/07/2025 20:00:00
üïê ==========================================
üïê EXECU√á√ÉO CRON INICIADA
üìÖ Data/Hora: 09/07/2025 20:00:00
üïê ==========================================
... (etapas do pipeline) ...
‚úÖ ==========================================
‚úÖ EXECU√á√ÉO CRON CONCLU√çDA COM SUCESSO
üìÖ Data/Hora: 09/07/2025 20:15:30
‚úÖ ==========================================
```

#### Execu√ß√£o manual

Voc√™ pode disparar o pipeline manualmente a qualquer momento:
```bash
curl -X GET http://localhost:3100/api/pipeline/execute
```

O pipeline ser√° executado sequencialmente e voc√™ receber√° o status de cada etapa.

#### Observa√ß√£o
- O cron √© inicializado automaticamente junto com a API (`npm run api`).
- N√£o √© necess√°rio configurar crontab do sistema.
- O agendamento √© robusto e n√£o executa em duplicidade.

## üìÅ Estrutura do Projeto

```
SCRAPER-TECHCRUNCH/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ scraper.ts                    # C√≥digo principal do scraper
‚îÇ   ‚îú‚îÄ‚îÄ scraper-index.ts              # Script de execu√ß√£o do scraper
‚îÇ   ‚îú‚îÄ‚îÄ translator.ts                 # C√≥digo do tradutor
‚îÇ   ‚îú‚îÄ‚îÄ translator-index.ts           # Script de execu√ß√£o do tradutor
‚îÇ   ‚îú‚îÄ‚îÄ podcast-generator.ts          # C√≥digo do gerador de roteiro de podcast
‚îÇ   ‚îú‚îÄ‚îÄ podcast-generator-index.ts    # Script de execu√ß√£o do gerador de podcast
‚îÇ   ‚îú‚îÄ‚îÄ audio-generator.ts            # C√≥digo do gerador de √°udio MP3
‚îÇ   ‚îú‚îÄ‚îÄ audio-generator-index.ts      # Script de execu√ß√£o do gerador de √°udio
‚îÇ   ‚îú‚îÄ‚îÄ merge-audio-image.ts          # C√≥digo do gerador de v√≠deo MP4
‚îÇ   ‚îú‚îÄ‚îÄ merge-audio-image-index.ts    # Script de execu√ß√£o do gerador de v√≠deo
‚îÇ   ‚îú‚îÄ‚îÄ upload_to_youtube.ts          # C√≥digo do upload para YouTube
‚îÇ   ‚îú‚îÄ‚îÄ upload_to_youtube_index.ts    # Script de execu√ß√£o do upload
‚îÇ   ‚îú‚îÄ‚îÄ get_refresh_token.ts          # Script de autoriza√ß√£o OAuth2
‚îÇ   ‚îú‚îÄ‚îÄ full-pipeline.ts              # Pipeline completo (todas as etapas)
‚îÇ   ‚îú‚îÄ‚îÄ api-index.ts                  # Script de inicializa√ß√£o da API
‚îÇ   ‚îú‚îÄ‚îÄ api/                          # API RESTful
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ server.ts                 # Servidor Express principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ docs.ts                   # Documenta√ß√£o da API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routes/                   # Rotas da API
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ news.ts               # Rotas de not√≠cias
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ podcast.ts            # Rotas de podcast
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ youtube.ts            # Rotas do YouTube
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pipeline.ts           # Rotas do pipeline
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ output.ts             # Rotas de output
‚îÇ   ‚îî‚îÄ‚îÄ types.ts                      # Defini√ß√µes de tipos TypeScript
‚îú‚îÄ‚îÄ dist/                    # C√≥digo compilado (gerado automaticamente)
‚îú‚îÄ‚îÄ package.json             # Depend√™ncias e scripts
‚îú‚îÄ‚îÄ tsconfig.json            # Configura√ß√£o do TypeScript
‚îú‚îÄ‚îÄ env.example              # Exemplo de vari√°veis de ambiente
‚îú‚îÄ‚îÄ README.md                # Este arquivo
‚îú‚îÄ‚îÄ credentials/
‚îÇ   ‚îú‚îÄ‚îÄ podcast-tech-news-key.json # Credenciais do Google Cloud (Translation, TTS, Gemini)
‚îÇ   ‚îú‚îÄ‚îÄ oAuthCredentials.json # Credenciais OAuth2 para YouTube (opcional)
‚îÇ   ‚îî‚îÄ‚îÄ youtube_token.json # Tokens de acesso do YouTube (gerado automaticamente)
‚îú‚îÄ‚îÄ output/
‚îÇ   ‚îú‚îÄ‚îÄ news/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ news_YYYY-MM-DD.json # Artigos originais e traduzidos (gerado automaticamente)
‚îÇ   ‚îú‚îÄ‚îÄ roteiro/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ roteiro_podcast_YYYY-MM-DD.txt # Roteiro do podcast (gerado automaticamente)
‚îÇ   ‚îú‚îÄ‚îÄ audio/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ audio_YYYY-MM-DD.mp3 # Podcast em √°udio (gerado automaticamente)
‚îÇ   ‚îî‚îÄ‚îÄ video/
‚îÇ       ‚îî‚îÄ‚îÄ podcast_video_YYYY-MM-DD.mp4 # V√≠deo para YouTube (gerado automaticamente)
```

## üìä Formatos de Sa√≠da

### Scraper e Tradutor (`output/news/news_YYYY-MM-DD.json`)

```json
{
  "dataColeta": "2025-01-08T10:30:00.000Z",
  "dataTraducao": "2025-01-08T10:35:00.000Z",
  "totalArtigos": 16,
  "artigos": [
    {
      "titulo": "Name of News",
      "url": "https://techcrunch.com/2025/01/08/news-example/",
      "dataPublicacao": "2025-01-08",
      "autor": "Author Name",
      "conteudo": "Paragraph 1 of the article... Paragraph 2...",
      "tituloTraduzido": "Nome da Not√≠cia",
      "conteudoTraduzido": "Par√°grafo 1 do artigo... Par√°grafo 2..."
    }
  ]
}
```

### Gerador de Podcast (`output/roteiro/roteiro_podcast_YYYY-MM-DD.txt`)

```
ROTEIRO DE PODCAST - TECHCRUNCH
Data: 08/07/2025
Gerado automaticamente com Gemini AI
=====================================

Jo√£o: E a√≠, galera! Sejam bem-vindos mais uma vez ao TechCast...

Maria: Tudo joia, Jo√£o! E hoje o papo vai ser quente, hein?...

Jo√£o: Come√ßando com uma bomba: "Em um golpe para o Google Cloud..."
```

### Gerador de √Åudio (`output/audio/audio_YYYY-MM-DD.mp3`)

Arquivo de √°udio MP3 contendo o podcast completo com:
- Voz masculina (Jo√£o) usando `pt-BR-Wavenet-B`
- Voz feminina (Maria) usando `pt-BR-Wavenet-A`
- Sequ√™ncia mantida conforme o roteiro original

### Gerador de V√≠deo (`output/video/podcast_video_YYYY-MM-DD.mp4`)

Arquivo de v√≠deo MP4 otimizado para YouTube contendo:
- √Åudio do podcast sincronizado
- Imagem est√°tica da capa (`TechCast.png`) durante toda a dura√ß√£o
- Codec H.264 para m√°xima compatibilidade
- Qualidade otimizada para upload no YouTube

### Upload para YouTube

O script de upload:
- Carrega automaticamente o v√≠deo do dia atual
- Autentica-se usando OAuth2 com refresh_token
- Faz upload com metadados otimizados:
  - T√≠tulo: "TechCast: Not√≠cias do dia DD/MM/YYYY"
  - Descri√ß√£o rica com hashtags e informa√ß√µes
  - Tags relevantes para SEO
  - Categoria: Ci√™ncia e Tecnologia
  - Visibilidade: P√∫blico
- Mostra progresso do upload em tempo real
- Exibe URL do v√≠deo ap√≥s conclus√£o

### API RESTful

A API RESTful oferece:
- **Endpoints individuais** para cada etapa do pipeline
- **Pipeline completo** via API
- **Listagem de arquivos** com ordena√ß√£o por data
- **Download de arquivos** espec√≠ficos
- **Status do pipeline** em tempo real
- **Documenta√ß√£o autom√°tica** em JSON
- **Tratamento de erros** robusto
- **Respostas padronizadas** em JSON
- **CORS habilitado** para integra√ß√£o frontend
- **Logs detalhados** de todas as opera√ß√µes

## ‚öôÔ∏è Configura√ß√µes

### Scraper

Voc√™ pode modificar as configura√ß√µes passando um objeto de configura√ß√£o para o construtor:

```typescript
import { TechCrunchScraper } from './src/scraper.js';

const scraper = new TechCrunchScraper({
  delay: 2000,        // Delay entre requisi√ß√µes (ms)
  maxArticles: 15,    // N√∫mero m√°ximo de artigos
  timeout: 15000,     // Timeout das requisi√ß√µes (ms)
  retries: 5          // N√∫mero de tentativas
});
```

### Tradutor

O tradutor usa as seguintes configura√ß√µes padr√£o:
- **Delay entre tradu√ß√µes:** 1000ms (para evitar rate limiting)
- **Idioma de origem:** Ingl√™s (en)
- **Idioma de destino:** Portugu√™s (pt)
- **MIME Type:** text/plain

## üõ°Ô∏è Recursos de Robustez

### Scraper
- **Retry autom√°tico:** Tentativas m√∫ltiplas em caso de falha de rede
- **Headers realistas:** Simula um navegador real para evitar bloqueios
- **Tratamento de erros:** Captura e trata erros de rede e parsing
- **Delay entre requisi√ß√µes:** Evita sobrecarregar o servidor
- **Filtros de conte√∫do:** Remove an√∫ncios, scripts e elementos indesejados
- **Seletores robustos:** M√∫ltiplos seletores para diferentes layouts
- **Tipagem forte:** TypeScript garante maior seguran√ßa e melhor DX

### Tradutor
- **Tratamento de erros:** Continua processando mesmo se uma tradu√ß√£o falhar
- **Rate limiting:** Delay entre tradu√ß√µes para respeitar limites da API
- **Fallback:** Mant√©m texto original em caso de erro
- **Valida√ß√£o de credenciais:** Verifica se as credenciais est√£o configuradas
- **Extra√ß√£o autom√°tica do Project ID:** Extrai do arquivo de credenciais se n√£o configurado

### Gerador de Podcast
- **IA generativa:** Usa Gemini AI para criar roteiros naturais e envolventes
- **Formato de di√°logo:** Simula conversa entre dois apresentadores
- **Tom informal:** Linguagem acess√≠vel e amig√°vel
- **Estrutura consistente:** Introdu√ß√£o, desenvolvimento e conclus√£o

### Gerador de √Åudio
- **Vozes distintas:** Voz masculina para Jo√£o, feminina para Maria
- **Qualidade Wavenet:** Usa vozes de alta qualidade do Google Cloud TTS
- **Concatena√ß√£o autom√°tica:** FFmpeg combina todos os segmentos
- **Limpeza autom√°tica:** Remove arquivos tempor√°rios ap√≥s conclus√£o
- **Rate limiting:** Delay entre gera√ß√µes para evitar limites da API

### Gerador de V√≠deo
- **Mesclagem autom√°tica:** Combina √°udio MP3 com imagem PNG
- **Otimiza√ß√£o para YouTube:** Codec H.264, formato MP4, qualidade AAC
- **Imagem est√°tica:** Exibe a capa durante toda a dura√ß√£o do √°udio
- **Compatibilidade m√°xima:** Formato de pixel yuv420p para todos os players
- **Qualidade profissional:** Bitrate de 192k para √°udio de alta qualidade

### Pipeline Completo
- **Execu√ß√£o sequencial:** Scraper ‚Üí Tradu√ß√£o ‚Üí Roteiro ‚Üí √Åudio ‚Üí V√≠deo ‚Üí Upload
- **Valida√ß√£o de dados:** Verifica se h√° artigos antes de cada etapa
- **Tratamento de erros:** Captura erros em todas as etapas
- **Upload opcional:** Upload para YouTube √© opcional e n√£o interrompe o pipeline
- **Feedback visual:** Mostra progresso de cada etapa
- **Execu√ß√£o individual:** Cada etapa pode ser executada separadamente

### API RESTful
- **Endpoints RESTful:** Todos os comandos dispon√≠veis via HTTP
- **Execu√ß√£o remota:** Pipeline pode ser executado remotamente
- **Integra√ß√£o f√°cil:** Compat√≠vel com qualquer frontend ou sistema
- **Documenta√ß√£o autom√°tica:** Endpoint `/api/docs` com documenta√ß√£o completa
- **Status em tempo real:** Endpoint `/api/pipeline/status` para monitoramento
- **Download de arquivos:** Endpoint para download direto de arquivos gerados
- **Ordena√ß√£o inteligente:** Arquivos listados por data de modifica√ß√£o (mais recentes primeiro)

## üîß Desenvolvimento

### Scripts dispon√≠veis:

- `npm run scraper` - Executa apenas o scraper (coleta not√≠cias)
- `npm run translate` - Executa apenas o tradutor (traduz not√≠cias usando Google Translate)
- `npm run translate:gemini` - Executa o tradutor usando Gemini AI (mais econ√¥mico)
- `npm run test:gemini` - Testa a conex√£o com Gemini AI
- `npm run podcast` - Gera roteiro do podcast usando Gemini AI
- `npm run audio` - Converte roteiro em arquivo de √°udio MP3
- `npm run video` - Gera v√≠deo MP4 para YouTube (√°udio + imagem)
- `npm run upload` - Faz upload do v√≠deo para o YouTube (requer autoriza√ß√£o OAuth2)
- `npm run full-pipeline` - Executa pipeline completo (scraper + tradu√ß√£o + podcast + √°udio + v√≠deo + upload)
- `npm run token` - Configura autoriza√ß√£o OAuth2 para upload no YouTube
- `npm run api` - Inicia a API RESTful (porta 3100)
- `npm run build` - Compila TypeScript para JavaScript
- `npm run watch` - Compila em modo watch
- `npm run clean` - Remove arquivos compilados

### Estrutura de tipos:

```typescript
interface Article {
  titulo: string;
  url: string;
  dataPublicacao: string;
  autor: string;
  conteudo: string;
}

interface TranslatedArticle extends Article {
  tituloTraduzido: string;
  conteudoTraduzido: string;
}

interface ScraperConfig {
  baseUrl: string;
  delay: number;
  maxArticles: number;
  timeout: number;
  retries: number;
}
```

## ‚ö†Ô∏è Considera√ß√µes Importantes

1. **Respeite os termos de uso:** Use este scraper de forma respons√°vel e respeite os termos de uso do TechCrunch
2. **Rate limiting:** O scraper inclui delays para n√£o sobrecarregar o servidor
3. **Custos da API:** O Google Cloud Translation API tem custos associados. Monitore seu uso
4. **Uso educacional:** Este projeto √© para fins educacionais e de demonstra√ß√£o
5. **Robustez:** O scraper pode precisar de ajustes se o site do TechCrunch mudar sua estrutura
6. **Node.js 22:** Certifique-se de usar a vers√£o correta do Node.js

## üîß Solu√ß√£o de Problemas

### Erro de vers√£o do Node.js
```bash
# Verificar vers√£o atual
node --version

# Se n√£o for 22, usar NVM
nvm use 22
```

### Erro de credenciais do Google Cloud
```bash
# Verificar se o arquivo de credenciais existe
ls -la podcast-tech-news-key.json

# Verificar vari√°veis de ambiente
echo $GOOGLE_APPLICATION_CREDENTIALS
echo $GOOGLE_CLOUD_PROJECT_ID
```

### Erro de rede
- Verifique sua conex√£o com a internet
- O scraper tentar√° novamente automaticamente

### Nenhum artigo encontrado
- O site pode ter mudado sua estrutura HTML
- Verifique se o TechCrunch est√° acess√≠vel

### Erro de tradu√ß√£o
- Verifique se a Translation API est√° habilitada no Google Cloud
- Verifique se as credenciais est√£o corretas
- Verifique se h√° cr√©ditos dispon√≠veis na conta

### Erro de gera√ß√£o de √°udio
- Verifique se o FFmpeg est√° instalado e acess√≠vel no PATH
- Verifique se a Text-to-Speech API est√° habilitada no Google Cloud
- Verifique se h√° cr√©ditos dispon√≠veis na conta
- Verifique se o arquivo de roteiro existe para a data atual

### Erro de gera√ß√£o de v√≠deo
- Verifique se o FFmpeg est√° instalado e acess√≠vel no PATH
- Verifique se o arquivo de √°udio existe para a data atual
- Verifique se o arquivo `TechCast.png` existe na raiz do projeto
- Verifique se h√° espa√ßo suficiente em disco para o arquivo de v√≠deo

### Erro de autoriza√ß√£o do YouTube
- Verifique se o arquivo `credentials/oAuthCredentials.json` existe
- Verifique se a YouTube Data API v3 est√° habilitada no Google Cloud Console
- Verifique se as credenciais OAuth2 est√£o configuradas como "Desktop application"
- Se o token expirou, execute `npm run token` novamente para renovar
- Verifique se a conta Google tem permiss√µes para o canal do YouTube

### Erro de upload para YouTube
- Verifique se o arquivo de v√≠deo existe para a data atual
- Verifique se o arquivo `credentials/youtube_token.json` existe e √© v√°lido
- Verifique se a YouTube Data API v3 est√° habilitada no Google Cloud Console
- Verifique se h√° espa√ßo suficiente em disco para o upload
- Verifique se a conex√£o com a internet est√° est√°vel
- Se o upload falhar, tente executar `npm run upload` manualmente

### Erro da API RESTful
- Verifique se a porta 3100 est√° dispon√≠vel
- Verifique se todas as depend√™ncias est√£o instaladas (`npm install`)
- Verifique se o arquivo `.env` est√° configurado corretamente
- Verifique se as credenciais do Google Cloud est√£o configuradas
- Se a API n√£o iniciar, verifique os logs de erro no console
- Para reiniciar a API, pare o processo e execute `npm run api` novamente

### Erros de TypeScript
```bash
# Verificar erros de compila√ß√£o
npm run build

# Executar em modo desenvolvimento para ver erros em tempo real
npm run dev
```

## üöÄ Pr√≥ximos Passos

### Melhorias Futuras
- **Interface Web:** Dashboard para gerenciar o pipeline
- **Agendamento:** Execu√ß√£o autom√°tica em hor√°rios espec√≠ficos
- **Notifica√ß√µes:** Webhooks para notificar conclus√£o de etapas
- **M√©tricas:** Dashboard com estat√≠sticas de uso
- **M√∫ltiplas fontes:** Suporte a outros sites de not√≠cias
- **Personaliza√ß√£o:** Configura√ß√£o de vozes e estilos de podcast

## üìù Licen√ßa

MIT License - Use livremente para fins educacionais.

## ü§ù Contribui√ß√µes

Sinta-se √† vontade para contribuir com melhorias, corre√ß√µes de bugs ou novas funcionalidades! 